<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather Tables 2.0</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poetsen+One&display=swap"
      rel="stylesheet"
    />
    <style>
      html {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
          sans-serif;
        font-weight: 400;
      }
      body {
        margin: 0;
      }
      p {
        margin: 0;
      }
      .city-container {
        padding: 0 0 12px 0;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        background-color: white;
        border: 1px solid rgb(0, 0, 0, 0.2);
        box-shadow: 0 5px 10px 0px rgb(0, 0, 0, 0.2);
      }
      .page-container {
        margin: auto;
        max-width: 1180px;
        padding-bottom: 2rem;
      }
      .custom-weather-table {
        margin-top: 20px;
        border: 1px solid #dededf;
        height: 100%;
        width: 100%;
        table-layout: fixed;
        border-collapse: collapse;
        border-spacing: 1px;
        text-align: center;
        font-family: Arial, sans-serif;
      }
      .custom-weather-table th {
        border: 1px solid #dededf;
        background-color: #0036d6;
        text-align: center;
        color: white;
        padding: 10px 5px;
      }
      .custom-weather-table td {
        border: 1px solid #dededf;
        background-color: #ffffff;
        text-align: center;
        color: #000000;
        padding: 5px;
        vertical-align: top;
      }
      .export-button {
        background-color: #000000;
        color: #ffffff;
        border: none;
        border-radius: 5px;
        padding: 10px 15px;
        margin-top: 10px;
        display: block;
        margin-left: auto;
        cursor: pointer;
        font-weight: bold;
      }

      .export-button:hover {
        background-color: #333333;
      }
    </style>
    <script>
      (async () => {
        const DAYS_OF_WEEK = {
          SUNDAY: 0,
          MONDAY: 1,
          TUESDAY: 2,
          WEDNESDAY: 3,
          THURSDAY: 4,
          FRIDAY: 5,
          SATURDAY: 6,
        };
        const regions = [
          {
            label: "DC 49: Winnipeg",
            id: "dc49",
            primaryBackgroundColour: "#8300FF",
            cities: [
              {
                label: "Winnipeg",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=49.854&long=-97.175&unit=metric&count=15&offset=0",
              },
              {
                label: "Brandon",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=49.85&long=-99.96&unit=metric&count=15&offset=0",
              },
              {
                label: "Morden",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=49.192&long=-98.112&unit=metric&count=15&offset=0",
              },
              {
                label: "Thompson",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=55.76&long=-97.842&unit=metric&count=15&offset=0",
              },
              {
                label: "Regina",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=50.455&long=-104.618&unit=metric&count=15&offset=0",
              },
              {
                label: "Kenora",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=49.779&long=-94.467&unit=metric&count=15&offset=0",
              },
              {
                label: "Thunder Bay",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=48.402&long=-89.31&unit=metric&count=15&offset=0",
              },
            ],
          },
          {
            label: "DC 56: Oshawa",
            id: "dc56",
            primaryBackgroundColour: "#009B43",
            cities: [
              {
                label: "Kingston",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=44.242&long=-76.501&unit=metric&count=15&offset=0",
              },
              {
                label: "Lindsay",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=44.353&long=-78.739&unit=metric&count=15&offset=0",
              },
              {
                label: "Newmarket",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=44.05&long=-79.462&unit=metric&count=15&offset=0",
              },
              {
                label: "Oshawa",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=43.941&long=-78.874&unit=metric&count=15&offset=0",
              },
              {
                label: "Peterborough",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=44.315&long=-78.321&unit=metric&count=15&offset=0",
              },
              {
                label: "Picton",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=44.005&long=-77.145&unit=metric&count=15&offset=0",
              },
              {
                label: "Toronto",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=43.667&long=-79.407&unit=metric&count=15&offset=0",
              },
              {
                label: "Ottawa",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=45.405&long=-75.695&unit=metric&count=15&offset=0",
              },
            ],
          },
          {
            label: "DC 06: Montreal",
            id: "dc06",
            primaryBackgroundColour: "#990070",
            cities: [
              {
                label: "Montréal",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=45.507&long=-73.556&unit=metric&count=15&offset=0",
              },
              {
                label: "Québec",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=46.814&long=-71.207&unit=metric&count=15&offset=0",
              },
              {
                label: "Mont-Tremblant",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=46.203&long=-74.613&unit=metric&count=15&offset=0",
              },
              {
                label: "Val-d'Or",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=48.099&long=-77.795&unit=metric&count=15&offset=0",
              },
              {
                label: "Sept-Îles",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=50.213&long=-66.38&unit=metric&count=15&offset=0",
              },
              {
                label: "Magog",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=45.267&long=-72.146&unit=metric&count=15&offset=0",
              },
              {
                label: "Ottawa",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=45.405&long=-75.695&unit=metric&count=15&offset=0",
              },
              {
                label: "Saguenay",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=48.435&long=-71.165&unit=metric&count=15&offset=0",
              },
              {
                label: "Rouyn-Noranda",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=48.211&long=-79.053&unit=metric&count=15&offset=0",
              },
            ],
          },
          {
            label: "DC 17: Brampton",
            id: "dc17",
            primaryBackgroundColour: "#998C00",
            cities: [
              {
                label: "Windsor",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=42.295&long=-82.995&unit=metric&count=15&offset=0",
              },
              {
                label: "London",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=42.951&long=-81.249&unit=metric&count=15&offset=0",
              },
              {
                label: "Hamilton",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=43.244&long=-79.837&unit=metric&count=15&offset=0",
              },
              {
                label: "Brampton",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=43.725&long=-79.744&unit=metric&count=15&offset=0",
              },
              {
                label: "Niagara Falls",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=43.051&long=-79.087&unit=metric&count=15&offset=0",
              },
              {
                label: "Kitchener",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=43.43&long=-80.483&unit=metric&count=15&offset=0",
              },
              {
                label: "Toronto",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=43.667&long=-79.407&unit=metric&count=15&offset=0",
              },
              {
                label: "Barrie",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=44.37&long=-79.697&unit=metric&count=15&offset=0",
              },
              {
                label: "Sault Ste. Marie",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=46.533&long=-84.368&unit=metric&count=15&offset=0",
              },
              {
                label: "Timmins",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=48.494&long=-81.355&unit=metric&count=15&offset=0",
              },
              {
                label: "Sudbury",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=46.485&long=-80.984&unit=metric&count=15&offset=0",
              },
            ],
          },
          {
            label: "DC 26: Vancouver",
            id: "dc26",
            primaryBackgroundColour: "#003D99",
            cities: [
              {
                label: "Prince George",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=53.927&long=-122.765&unit=metric&count=15&offset=0",
              },
              {
                label: "Smithers",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=54.791&long=-127.178&unit=metric&count=15&offset=0",
              },
              {
                label: "Prince Rupert",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=54.29&long=-130.307&unit=metric&count=15&offset=0",
              },
              {
                label: "Port Hardy",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=50.697&long=-127.456&unit=metric&count=15&offset=0",
              },
              {
                label: "Victoria",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=48.427&long=-123.347&unit=metric&count=15&offset=0",
              },
              {
                label: "Hope",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=49.374&long=-121.413&unit=metric&count=15&offset=0",
              },
              {
                label: "Squamish",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=49.756&long=-123.118&unit=metric&count=15&offset=0",
              },
              {
                label: "Sechelt",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=49.491&long=-123.799&unit=metric&count=15&offset=0",
              },
              {
                label: "Vancouver",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=49.257&long=-123.113&unit=metric&count=15&offset=0",
              },
            ],
          },
          {
            label: "DC 34: Calgary",
            id: "dc34",
            primaryBackgroundColour: "#D13437",
            cities: [
              {
                label: "Calgary",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=51.028&long=-114.05&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.SUNDAY,
                  DAYS_OF_WEEK.MONDAY,
                  DAYS_OF_WEEK.TUESDAY,
                  DAYS_OF_WEEK.WEDNESDAY,
                  DAYS_OF_WEEK.THURSDAY,
                  DAYS_OF_WEEK.FRIDAY,
                  DAYS_OF_WEEK.SATURDAY,
                ],
              },
              {
                label: "Red Deer",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=52.279&long=-113.791&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.MONDAY,
                  DAYS_OF_WEEK.TUESDAY,
                  DAYS_OF_WEEK.WEDNESDAY,
                  DAYS_OF_WEEK.SATURDAY,
                ],
              },
              {
                label: "Edmonton",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=53.556&long=-113.558&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.SUNDAY,
                  DAYS_OF_WEEK.MONDAY,
                  DAYS_OF_WEEK.TUESDAY,
                  DAYS_OF_WEEK.WEDNESDAY,
                  DAYS_OF_WEEK.THURSDAY,
                  DAYS_OF_WEEK.FRIDAY,
                  DAYS_OF_WEEK.SATURDAY,
                ],
              },
              {
                label: "Lethbridge",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=49.688&long=-112.852&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.SUNDAY,
                  DAYS_OF_WEEK.TUESDAY,
                  DAYS_OF_WEEK.WEDNESDAY,
                  DAYS_OF_WEEK.FRIDAY,
                  DAYS_OF_WEEK.SATURDAY,
                ],
              },
              {
                label: "Medicine Hat",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=50.051&long=-110.705&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.WEDNESDAY,
                  DAYS_OF_WEEK.SATURDAY,
                ],
              },
              {
                label: "Lloydminster",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=53.278&long=-110.036&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.TUESDAY,
                  DAYS_OF_WEEK.SATURDAY,
                ],
              },
              {
                label: "Grande Prairie",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=55.16&long=-118.804&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.SUNDAY,
                  DAYS_OF_WEEK.WEDNESDAY,
                ],
              },
              {
                label: "Fort McMurray",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=56.718&long=-111.369&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [DAYS_OF_WEEK.MONDAY, DAYS_OF_WEEK.THURSDAY],
              },
              {
                label: "Peace River",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=56.232&long=-117.32&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [DAYS_OF_WEEK.MONDAY, DAYS_OF_WEEK.FRIDAY],
              },
              {
                label: "Kelowna",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=49.9&long=-119.425&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.SUNDAY,
                  DAYS_OF_WEEK.MONDAY,
                  DAYS_OF_WEEK.TUESDAY,
                  DAYS_OF_WEEK.WEDNESDAY,
                  DAYS_OF_WEEK.THURSDAY,
                  DAYS_OF_WEEK.SATURDAY,
                ],
              },
              {
                label: "Golden",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=51.299&long=-116.964&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.SUNDAY,
                  DAYS_OF_WEEK.MONDAY,
                  DAYS_OF_WEEK.TUESDAY,
                  DAYS_OF_WEEK.WEDNESDAY,
                  DAYS_OF_WEEK.THURSDAY,
                  DAYS_OF_WEEK.FRIDAY,
                  DAYS_OF_WEEK.SATURDAY,
                ],
              },
              {
                label: "Kamloops",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=50.675&long=-120.326&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [DAYS_OF_WEEK.TUESDAY],
              },
              {
                label: "Vernon",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=50.236&long=-119.357&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [DAYS_OF_WEEK.THURSDAY],
              },
              {
                label: "Revelstoke",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=51.006&long=-118.221&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.SUNDAY,
                  DAYS_OF_WEEK.WEDNESDAY,
                ],
              },
              {
                label: "Prince George",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=53.927&long=-122.765&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.SUNDAY,
                  DAYS_OF_WEEK.TUESDAY,
                  DAYS_OF_WEEK.WEDNESDAY,
                  DAYS_OF_WEEK.FRIDAY,
                ],
              },
              {
                label: "Dawson Creek",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=55.757&long=-120.237&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.SUNDAY,
                  DAYS_OF_WEEK.WEDNESDAY,
                ],
              },
              {
                label: "Saskatoon",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=52.151&long=-106.663&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.SUNDAY,
                  DAYS_OF_WEEK.MONDAY,
                  DAYS_OF_WEEK.TUESDAY,
                  DAYS_OF_WEEK.WEDNESDAY,
                  DAYS_OF_WEEK.THURSDAY,
                  DAYS_OF_WEEK.FRIDAY,
                ],
              },
              {
                label: "Prince Albert",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=53.216&long=-105.714&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.SUNDAY,
                  DAYS_OF_WEEK.WEDNESDAY,
                ],
              },
              {
                label: "North Battleford",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=52.757&long=-108.294&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.TUESDAY,
                  DAYS_OF_WEEK.SATURDAY,
                ],
              },
              {
                label: "Melfort",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=52.856&long=-104.603&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [DAYS_OF_WEEK.TUESDAY, DAYS_OF_WEEK.FRIDAY],
              },
              {
                label: "Drumheller",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=51.406&long=-112.618&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [DAYS_OF_WEEK.MONDAY],
              },
              {
                label: "Fernie",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=49.505&long=-115.052&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.WEDNESDAY,
                  DAYS_OF_WEEK.SATURDAY,
                ],
              },
              {
                label: "Bonnyville",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=54.268&long=-110.755&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [DAYS_OF_WEEK.MONDAY, DAYS_OF_WEEK.THURSDAY],
              },
              {
                label: "Kindersley",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=51.467&long=-109.156&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [DAYS_OF_WEEK.MONDAY, DAYS_OF_WEEK.FRIDAY],
              },
              {
                label: "Hinton",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=53.401&long=-117.573&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.TUESDAY,
                  DAYS_OF_WEEK.SATURDAY,
                ],
              },
              {
                label: "Castlegar",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=49.295&long=-117.654&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.WEDNESDAY,
                  DAYS_OF_WEEK.SATURDAY,
                ],
              },
              {
                label: "Cardston",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=49.194&long=-113.308&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [DAYS_OF_WEEK.SATURDAY],
              },
              {
                label: "Invermere",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=50.505&long=-116.035&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.TUESDAY,
                  DAYS_OF_WEEK.SATURDAY,
                ],
              },
              {
                label: "Cranbrook",
                url: "https://weatherapi.pelmorex.com/api/v1/longterm?locale=en-CA&lat=49.514&long=-115.761&unit=metric&count=15&offset=0",
                daysOfWeekEnabled: [
                  DAYS_OF_WEEK.WEDNESDAY,
                  DAYS_OF_WEEK.SATURDAY,
                ],
              },
            ],
          },
        ];

        // Calculate the day it is
        const dayOfWeekTwoDaysFromNow = (new Date().getDay() + 3) % 7;

        // The fetching of the API data from the website
        const regionsAPIData = await Promise.all(
          regions.map(async (region) => {
            const citiesAPIData = await Promise.all(
              region.cities
                .filter((city) => {
                  if (!city.daysOfWeekEnabled) {
                    return true;
                  }
                  if (
                    // Array.isArray(city.daysOfWeekEnabled) &&
                    city.daysOfWeekEnabled?.includes(dayOfWeekTwoDaysFromNow)
                  ) {
                    return true;
                  }
                })
                .map(async (city) => {
                  const res = await fetch(city.url);
                  const rawData = await res.json();
                  const cityData = {
                    date: new Date(
                      rawData.longTerm[3].time.local
                    ).toLocaleDateString(),
                    temperature: rawData.longTerm[3].day.temperature.value,
                    snow: rawData.longTerm[3].snow.value,
                    wind: rawData.longTerm[3].day.wind.speed,
                    rain: rawData.longTerm[3].rain.value,
                  };
                  const cityUnits = {
                    snow: rawData.display.unit.snow,
                    wind: rawData.display.unit.wind,
                    temperature: rawData.display.unit.temperature,
                    rain: rawData.display.unit.rain,
                  };
                  return {
                    label: city.label,
                    data: cityData,
                    units: cityUnits,
                  };
                })
            );

            return {
              ...region,
              cities: citiesAPIData,
            };
          })
        );

        console.log(regionsAPIData);

        // Basicaly the alert section im assuming this is what makes the text red
        const regionsData = regionsAPIData.map((region) => {
          const citiesData = region.cities.map((city) => {
            const windAlert = city.data.wind > 40;
            const snowAlert = city.data.snow > 0;
            const rainAlert = city.data.rain > 0;

            const generalAlert = windAlert || snowAlert || rainAlert;

            return {
              ...city,
              alert: {
                wind: windAlert,
                snow: snowAlert,
                rain: rainAlert,
                general: generalAlert,
              },
            };
          });
          // .sort((a, b) => (a.alert.general ? -1 : 1));

          return {
            ...region,
            cities: citiesData,
          };
        });

        // the div he is adding all the content into
        const pageContainer = document.querySelector("#page-container");

        // This is the top line where he is adding the date
        const dateHeader = document.createElement("h2");
        dateHeader.innerText = regionsData[0].cities[0].data.date;
        pageContainer.appendChild(dateHeader);

        // Now he is iterating over each region
        regionsData.forEach((region) => {
          // This is the overall container where the info for each region is associated in
          const regionContainer = document.createElement("div");
          regionContainer.style.paddingBottom = "2rem";
          pageContainer.appendChild(regionContainer);
          regionContainer.id = `region-${region.id}`;

          // this is the header of each single dc that he is adding into the overall region Container
          const regionHeader = document.createElement("h2");
          regionContainer.appendChild(regionHeader);
          regionHeader.innerText = region.label;
          regionHeader.style.borderBottom = `4px solid ${region.primaryBackgroundColour}`;

          // this is basically the card for each city that he is adding to each container
          const citiesContainer = document.createElement("div");
          regionContainer.appendChild(citiesContainer);
          citiesContainer.id = "halfway";
          citiesContainer.style.display = "flex";
          citiesContainer.style.flexWrap = "wrap";
          citiesContainer.style.gap = "16px";

          // the container for the table
          const tableContainer = document.createElement("div");
          regionContainer.appendChild(tableContainer);

          // this is the export button

          // this is basically the structure of the table
          const table = document.createElement("table");
          table.className = "custom-weather-table";
          const thead = document.createElement("thead");
          const tbody = document.createElement("tbody");

          // create header row
          const headerRow = document.createElement("tr");
          const headerCategories = [
            "Region",
            "Temperature",
            "Snow (cm)",
            "Rain (mm)",
            "Wind (km/h)",
            "Additional Time",
          ];

          headerCategories.forEach((i) => {
            if (
              i === "Wind (km/h)" &&
              (region.label === "DC 56: Oshawa" ||
                region.label === "DC 06: Montreal" ||
                region.label === "DC 17: Brampton" ||
                region.label === "DC 26: Vancouver")
            )
              return;
            if (
              i === "Temperature" &&
              (region.label === "DC 49: Winnipeg" ||
                region.label === "DC 56: Oshawa" ||
                region.label === "DC 06: Montreal" ||
                region.label === "DC 26: Vancouver" ||
                region.label === "DC 34: Calgary")
            )
              return;

            const th = document.createElement("th");
            th.textContent = i;
            headerRow.appendChild(th);
          });

          thead.appendChild(headerRow);
          table.appendChild(thead);
          table.appendChild(tbody);
          tableContainer.appendChild(table);

          // creating export button component
          const button = document.createElement("button");
          button.className = "export-button";
          button.innerText = "Export";

          button.onclick = function () {
            exportTable(table, `${region.label}_weather_data.csv`);
          };

          tableContainer.appendChild(button);

          // this is basically him iterating over each city inside the region we can use this here
          region.cities
            //.filter((city) => city.snow > 0 || city.wind > 0)
            .forEach((city) => {
              const cityContainer = document.createElement("div");
              cityContainer.id = `city-${city.label}`;
              // cityContainer.style.backgroundColor =
              //   region.primaryBackgroundColour;
              cityContainer.className = "city-container";
              citiesContainer.appendChild(cityContainer);

              // add a red outline if there is an alert
              if (city.alert.general) {
                cityContainer.style.outline = "2px solid crimson";
              }

              // this is the label of the city card
              const cityLabel = document.createElement("p");
              cityLabel.innerText = `${city.label}`;
              cityLabel.style.fontWeight = "bold";
              cityLabel.style.textAlign = "center";
              cityLabel.style.padding = "6px 0 6px 0";
              cityLabel.style.borderBottom = "1px solid rgb(0, 0, 0, 0.2)";

              // cityLabel.style.textDecoration = "underline";

              cityContainer.appendChild(cityLabel);

              // const cityDate = document.createElement("p");
              // cityDate.innerText = `Date: ${city.data.date}`;
              // cityContainer.appendChild(cityDate);

              // this is the temperature row
              const cityTemperature = document.createElement("p");
              cityTemperature.innerText = `Temperature: ${city.data.temperature}°${city.units.temperature}`;
              cityTemperature.style.padding = "0 12px 0 12px";
              cityContainer.appendChild(cityTemperature);

              // this is the city snow row
              const citySnow = document.createElement("p");
              citySnow.innerText = `Snow: ${city.data.snow} ${city.units.snow}`;
              citySnow.style.padding = "0 12px 0 12px";
              cityContainer.appendChild(citySnow);
              if (city.alert.snow) {
                citySnow.style.color = "red";
              }

              // this is city rain row
              const cityRain = document.createElement("p");
              cityRain.innerText = `Rain: ${city.data.rain} ${city.units.rain}`;
              cityRain.style.padding = "0 12px 0 12px";
              cityContainer.appendChild(cityRain);
              if (city.alert.rain) {
                cityRain.style.color = "red";
              }

              // this is city wind row
              const cityWind = document.createElement("p");
              cityWind.innerText = `Wind: ${city.data.wind} ${city.units.wind}`;
              cityWind.style.padding = "0 12px 0 12px";
              cityContainer.appendChild(cityWind);
              if (city.alert.wind) {
                cityWind.style.color = "red";
              }

              // TABLE CREATION
              // table row creation
              const row = document.createElement("tr");

              //table Elements creations
              const regionCell = document.createElement("td");
              regionCell.textContent = `${city.label}`;
              row.appendChild(regionCell);

              if (
                !(
                  region.label === "DC 49: Winnipeg" ||
                  region.label === "DC 56: Oshawa" ||
                  region.label === "DC 06: Montreal" ||
                  region.label === "DC 26: Vancouver" ||
                  region.label === "DC 34: Calgary"
                )
              ) {
                const tempCell = document.createElement("td");
                tempCell.textContent = `${city.data.temperature}°${city.units.temperature}`;
                row.appendChild(tempCell);
              }

              const snowCell = document.createElement("td");
              snowCell.textContent = `${city.data.snow}`;
              row.appendChild(snowCell);

              const rainCell = document.createElement("td");
              rainCell.textContent = `${city.data.rain}`;
              row.appendChild(rainCell);

              if (
                !(
                  region.label === "DC 56: Oshawa" ||
                  region.label === "DC 06: Montreal" ||
                  region.label === "DC 17: Brampton" ||
                  region.label === "DC 26: Vancouver"
                )
              ) {
                const windCell = document.createElement("td");
                windCell.textContent = `${city.data.wind}`;
                row.appendChild(windCell);
              }

              const infoCell = document.createElement("td");
              const snowVal = parseFloat(city.data.snow);
              const rainVal = parseFloat(city.data.rain);
              const tempVal = parseFloat(city.data.temperature);

              // logic for what to put in the addiontal comment area

              // Oshawa DC
              if (region.label == "DC 56: Oshawa") {
                if (city.label == "Picton" && snowVal > 0) {
                  infoCell.textContent = "15 mins before first stop";
                } else if (snowVal <= 3 && rainVal <= 3) {
                  infoCell.textContent = "No changes";
                } else if (
                  (snowVal > 3 && snowVal <= 5) ||
                  (rainVal > 3 && rainVal <= 5)
                ) {
                  infoCell.textContent = "15 mins before first stop";
                } else if (
                  (snowVal > 5 && snowVal <= 10) ||
                  (rainVal > 5 && rainVal <= 10)
                ) {
                  infoCell.textContent =
                    "15 mins before first stop + 15 mins between deliveries";
                } else {
                  infoCell.textContent =
                    "30 mins before first stop + 15 mins between deliveries";
                }
              } else {
                if (
                  region.label == "DC 06: Montreal" ||
                  region.label == "DC 26: Vancouver"
                ) {
                  infoCell.textContent = "";
                } else if (snowVal <= 3) {
                  infoCell.textContent = "No changes";
                } else if (snowVal > 3 && snowVal <= 5) {
                  infoCell.textContent = "15 mins before first stop";
                } else if (snowVal > 5 && snowVal <= 10) {
                  infoCell.textContent =
                    "15 mins before first stop + 15 mins between deliveries";
                } else {
                  infoCell.textContent =
                    "30 mins before first stop + 15 mins between deliveries";
                }
              }

              row.appendChild(infoCell);
              tbody.appendChild(row);
            });
        });
      })();

      function exportTable(table, filename) {
        var csv = [];

        // gets the row of the table
        var rows = table.querySelectorAll("tr");

        // basically go through all thw rows one by one
        for (var i = 0; i < rows.length; i++) {
          var row = [];

          // fetch every collumn within the row
          var cols = rows[i].querySelectorAll("td, th");

          // go through every single element of the rows by basically iterating over the cols
          for (var j = 0; j < cols.length; j++) {
            // fetches the text in each cell and pushes it into the rows variable we made earlier
            var data = cols[j].innerText;
            row.push(data);
          }

          csv.push(row.join(","));
        }

        var CSV_Final = csv.join("\n");

        // all the stuff needed to download the file
        var a = document.createElement("a");
        var bom = "\ufeff";
        a.href =
          "data:text/csv;charset=utf-8," + encodeURIComponent(bom + CSV_Final);
        a.setAttribute("download", filename);
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }
    </script>
  </head>
  <body>
    <div class="page-container" id="page-container"></div>
  </body>
</html>
